# PyKara

※ **このプロジェクトは現在開発途中（WIP）です**
仕様・API・内部構造は予告なく変更される可能性があります。

---

## 概要

**PyKara** は、Python で動作する **ローカル通信型カラオケシステム** です。
業務用通信カラオケ（DAM / JOYSOUND 等）の運用思想を参考に、

* 再生・制御を行う **Commander（本体）**
* 選曲・操作を行う **Remote（選曲端末）**

を分離した構成を目指しています。

本プロジェクトは **個人開発・研究用途** を目的としており、
実在する業務用製品・サービスとは一切関係ありません。

---

## 開発状況（2026年現在）

*  基本的な起動フロー（黒画面 → OP → アトラクト）実装中
*  選曲キュー管理（SelectionManager）実装中
*  HTTP API / Web UI 連携 開発中
*  WebSocket 常時接続・状態同期 未実装
*  楽曲再生・採点・同期処理 未実装

 **現時点では「システムの骨格」を構築している段階です**

---

## 主な機能（実装済 / 実装予定）

* **アトラクトモード**

  * フルスクリーンで待機
  * OP 動画再生後に遷移
* **電源操作フロー**

  * 起動時黒画面（初期化時間再現）
  * ESC 長押しによる電源OFF相当処理
  * フェード → ED 再生 → 終了
* **選曲管理**

  * 選曲キューの保持
  * 外部 API からの予約投入
* **HTTP API サーバー（開発用）**

  * ブラウザ等からの操作を想定
* **設定機能**

  * フォント / テーマ
  * サーバー設定
  * デバッグ設定

---

## システム構成（想定）

```
[ Remote (選曲端末) ]
   └─ Web UI (HTML / JS)
        │
        │ HTTP / WebSocket
        ▼
[ PyKara Commander ]
   ├─ 再生制御
   ├─ 状態管理
   ├─ 選曲キュー
   └─ API / WS サーバ
```

* Remote は **常時接続**
* Commander が **唯一の制御主体**
* 再生状態は Commander → Remote に Push される想定

---

## セットアップ（開発者向け）

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. 起動

```bash
python main.py
```

Windows の場合:

```bat
run.bat
```

---

## API サーバー（開発用）

アプリ起動時に **Commander 内部で HTTP API サーバーが起動**します。

> ※ 将来的には WebSocket 常時接続に置き換える予定です

### エンドポイント例（暫定）

* `GET /status`
  → 動作状態を取得

* `GET /queue`
  → 選曲キューを取得

* `POST /reserve`
  → 選曲を予約

```json
{
  "song_id": "TEST001",
  "title": "曲名",
  "artist": "アーティスト名"
}
```

* `POST /shutdown`
  → Commander の終了要求（管理用）

---

## 設定

`config.json` で以下を設定可能です。

* フォント（種類 / サイズ）
* テーマ（背景色 / テキスト色）
* API サーバ設定
* デバッグ設定

### デバッグモード

```json
{
  "debug": {
    "enabled": true,
    "show_traceback": true,
    "log_to_file": false,
    "log_file": "pykara_debug.log"
  }
}
```

デバッグモード有効時:

* 詳細ログ出力
* 例外時スタックトレース表示
* 任意でログファイル保存

---

## 注意事項

* 本プロジェクトは **非公式・非商用・研究用途** です
* 実在の通信カラオケ機器・仕様とは互換性を保証しません
* 商用利用・実店舗利用は想定していません

---

## 今後の予定（ロードマップ）

* [ ] Remote Web UI の本格実装
* [ ] WebSocket 常時接続
* [ ] 再生状態の Push 同期
* [ ] 複数 Remote 対応
* [ ] 端末ペアリング機構
* [ ] 実機風 UI / UX 調整
